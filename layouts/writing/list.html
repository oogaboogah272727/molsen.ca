{{ define "main" }}
<h1>{{ .Title }}</h1>

{{ with .Content }}
  <div class="section-intro">{{ . }}</div>
{{ end }}

{{ $types := slice "foundational" "core" "theoretical" "empirical" "applied" "practice" "update" "response" }}
{{ $typeLabels := dict "foundational" "Foundational" "core" "Core" "theoretical" "Theoretical" "empirical" "Empirical" "applied" "Applied" "practice" "Practice" "update" "Update" "response" "Response" }}
{{ $typeDescriptions := dict "foundational" "Defining concepts and core distinctions" "core" "The central frameworks" "theoretical" "Extending the foundations" "empirical" "Evidence and experiments" "applied" "Applying the framework" "practice" "Lessons from experience" "update" "Framework validation and evolution" "response" "Engaging critique and refining claims" }}

<div class="article-tabs">
  {{ range $i, $type := $types }}
    {{ $pages := where $.Pages "Params.type" $type }}
    {{ if $pages }}
    <button class="tab-button{{ if eq $i 0 }} active{{ end }}" data-tab="{{ $type }}">
      <span class="type-dot {{ $type }}"></span>
      {{ index $typeLabels $type }}
      <span class="tab-count">{{ len $pages }}</span>
    </button>
    {{ end }}
  {{ end }}
</div>

{{ range $i, $type := $types }}
  {{ $pages := where $.Pages "Params.type" $type }}
  {{ if $pages }}
  <section class="article-group{{ if eq $i 0 }} active{{ end }}" data-tab-content="{{ $type }}">
    <p class="group-description">{{ index $typeDescriptions $type }}</p>
    <ul class="article-list">
      {{ range $pages.ByDate.Reverse }}
      <li class="article-item">
        <a href="{{ .RelPermalink }}" class="article-link">
          <span class="article-title">{{ .Title }}</span>
          {{ with .Params.description }}<span class="article-description">{{ . }}</span>{{ end }}
        </a>
        {{ with .Params.tags }}
        <div class="article-tags">
          {{ range . }}<a href="/tags/{{ . | urlize }}/" class="tag">{{ . }}</a>{{ end }}
        </div>
        {{ end }}
      </li>
      {{ end }}
    </ul>
  </section>
  {{ end }}
{{ end }}

<script>
document.querySelectorAll('.tab-button').forEach(function(button) {
  button.addEventListener('click', function() {
    document.querySelectorAll('.tab-button').forEach(function(b) { b.classList.remove('active'); });
    document.querySelectorAll('.article-group').forEach(function(g) { g.classList.remove('active'); });
    button.classList.add('active');
    var tab = button.getAttribute('data-tab');
    document.querySelector('[data-tab-content="' + tab + '"]').classList.add('active');
  });
});
</script>

{{ end }}
