{{ define "main" }}
<p class="intro">{{ .Site.Params.description }}</p>

<div class="hero-cards">
  <a href="/writing/making-ai-make-sense/" class="hero-card hero-card-primary" target="_blank" rel="noopener">
    <span class="hero-label">Start Here</span>
    <span class="hero-title">Making AI Make Sense</span>
    <span class="hero-desc">The complete framework in one page</span>
  </a>
  <a href="https://chatgpt.com/g/g-6955c39bc1ac81919d433f0b950561b6-explore-mike-olsen-s-writing-on-molsen-ca" class="hero-card" target="_blank" rel="noopener">
    <span class="hero-label">Interactive</span>
    <span class="hero-title">Chat on ChatGPT</span>
    <span class="hero-desc">Explore these essays conversationally</span>
  </a>
  <a href="https://github.com/oogaboogah272727/molsen.ca-mcp" class="hero-card" target="_blank" rel="noopener">
    <span class="hero-label">For Developers</span>
    <span class="hero-title">MCP Server</span>
    <span class="hero-desc">Connect Claude Desktop or Claude Code</span>
  </a>
</div>

<div class="tabs-container">
  <div class="tab-nav">
    <button class="tab-btn active" data-tab="framework">Framework</button>
    <button class="tab-btn" data-tab="all">All Essays</button>
    <button class="tab-btn" data-tab="llm">For LLMs</button>
  </div>

  <div class="tab-content active" id="tab-framework">
    <p class="tab-intro">Essays in recommended reading order. Each builds on the previous.</p>
    <div class="framework-essays" id="framework-essays">
      <p class="loading">Loading essays...</p>
    </div>
  </div>

  <div class="tab-content" id="tab-all">
    <div class="tag-filters" id="tag-filters"></div>
    <div class="category-sections" id="category-sections">
      <p class="loading">Loading essays...</p>
    </div>
  </div>

  <div class="tab-content" id="tab-llm">
    <p class="tab-intro">This site is designed for AI agent accessibility. <a href="/for-llms/">Full documentation â†’</a></p>

    <h3 class="llm-section-title">Quick Start</h3>
    <div class="llm-options">
      <a href="/llms.txt" class="llm-option">
        <strong>llms.txt</strong>
        <span>Summary for context windows</span>
      </a>
      <a href="/llms-full.txt" class="llm-option">
        <strong>llms-full.txt</strong>
        <span>Complete essay content</span>
      </a>
      <a href="/ai.txt" class="llm-option">
        <strong>ai.txt</strong>
        <span>Agent instructions &amp; permissions</span>
      </a>
    </div>

    <h3 class="llm-section-title">Structured APIs</h3>
    <div class="llm-options">
      <a href="/api/essays.json" class="llm-option">
        <strong>/api/essays.json</strong>
        <span>All essays with metadata</span>
      </a>
      <a href="/js/knowledge-graph.json" class="llm-option">
        <strong>Knowledge Graph</strong>
        <span>Essay relationships</span>
      </a>
      <a href="/api/claims.json" class="llm-option">
        <strong>/api/claims.json</strong>
        <span>Structured arguments</span>
      </a>
      <a href="/api/paths.json" class="llm-option">
        <strong>/api/paths.json</strong>
        <span>Reading paths</span>
      </a>
      <a href="/api/glossary.json" class="llm-option">
        <strong>/api/glossary.json</strong>
        <span>Concept definitions</span>
      </a>
      <a href="/.well-known/openapi.json" class="llm-option">
        <strong>OpenAPI Spec</strong>
        <span>Full API documentation</span>
      </a>
    </div>
  </div>
</div>

<script>
const TYPE_LABELS = {
  'hub': 'Start Here',
  'foundational': 'Foundations',
  'core': 'Core Framework',
  'theoretical': 'Theory',
  'applied': 'Applied',
  'practice': 'Practice',
  'empirical': 'Empirical'
};

const TYPE_ORDER = ['hub', 'foundational', 'core', 'theoretical', 'applied', 'practice', 'empirical'];

const FRAMEWORK_ORDER = [
  'making-ai-make-sense',
  'knowledge-as-capability',
  'agent-relative-tacitness',
  'tacit-space-shrinkage',
  'ai-oracle-vs-assistant',
  'strong-oracle-trap',
  'executable-knowledge-architecture',
  'capability-governance',
  'agentic-ai-universal-interface',
  'automating-expertise-gets-easier',
  'ontology-generation',
  'what-benchmarks-arent-measuring',
  'ai-first-software',
  'return-of-the-assistant'
];

let essays = [];
let activeTags = new Set();

async function init() {
  const response = await fetch('/index.json');
  essays = await response.json();
  essays = essays.filter(e => e.title && !e.url.endsWith('/writing/'));

  renderFrameworkEssays();
  renderTagFilters();
  renderAllEssays();
  setupTabs();
}

function setupTabs() {
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
    });
  });
}

function renderFrameworkEssays() {
  const container = document.getElementById('framework-essays');
  const frameworkEssays = FRAMEWORK_ORDER
    .map(slug => essays.find(e => e.url.includes(slug)))
    .filter(Boolean);

  if (frameworkEssays.length === 0) {
    container.innerHTML = '<p class="no-results">No framework essays found.</p>';
    return;
  }

  container.innerHTML = frameworkEssays.map((e, i) => `
    <a href="${e.url}" class="framework-essay">
      <span class="framework-num">${i + 1}</span>
      <div class="framework-content">
        <span class="framework-title">${e.title}</span>
        <span class="framework-desc">${e.description || ''}</span>
      </div>
    </a>
  `).join('');
}

function renderTagFilters() {
  const allTags = new Set();
  essays.forEach(e => (e.tags || []).forEach(t => allTags.add(t)));

  const container = document.getElementById('tag-filters');
  container.innerHTML = Array.from(allTags).sort().map(tag =>
    `<button class="tag-btn" data-tag="${tag}">${tag}</button>`
  ).join('');

  container.querySelectorAll('.tag-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const tag = btn.dataset.tag;
      if (activeTags.has(tag)) {
        activeTags.delete(tag);
        btn.classList.remove('active');
      } else {
        activeTags.add(tag);
        btn.classList.add('active');
      }
      renderAllEssays();
    });
  });
}

function renderAllEssays() {
  const filtered = essays.filter(e => {
    if (activeTags.size > 0) {
      const hasTag = (e.tags || []).some(t => activeTags.has(t));
      if (!hasTag) return false;
    }
    return true;
  });

  const grouped = {};
  filtered.forEach(e => {
    const type = e.type || 'essay';
    if (!grouped[type]) grouped[type] = [];
    grouped[type].push(e);
  });

  const container = document.getElementById('category-sections');

  if (filtered.length === 0) {
    container.innerHTML = '<p class="no-results">No essays match your filters.</p>';
    return;
  }

  let html = '';
  TYPE_ORDER.forEach(type => {
    if (!grouped[type]) return;
    const label = TYPE_LABELS[type] || type;
    html += `<div class="category-section">
      <h2>${label}</h2>
      <div class="essay-grid">
        ${grouped[type].map(e => `
          <a href="${e.url}" class="essay-card">
            <h3>${e.title}</h3>
            <p>${e.description || ''}</p>
          </a>
        `).join('')}
      </div>
    </div>`;
  });

  container.innerHTML = html;
}

init();
</script>
{{ end }}
