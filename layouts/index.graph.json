{
  "nodes": [
{{- $essays := where .Site.RegularPages "Section" "writing" -}}
{{- $first := true -}}
{{- range $essays -}}
{{- if and (not .Params.hidden) .Params.graph_id -}}
{{- if not $first }},{{ end -}}
{{- $first = false }}
    {
      "id": {{ .Params.graph_id | jsonify }},
      "label": {{ .Title | jsonify }},
      "url": {{ .RelPermalink | jsonify }},
      "defines": {{ .Params.defines | default (slice) | jsonify }},
      "type": {{ .Params.type | default "essay" | jsonify }},
      "themes": {{ .Params.themes | default .Params.tags | default (slice) | jsonify }}
    }
{{- end -}}
{{- end }}
  ],
  "links": [
{{- $first := true -}}
{{- range $essays -}}
{{- if and (not .Params.hidden) .Params.graph_id .Params.relationships -}}
{{- $source := .Params.graph_id -}}
{{- range .Params.relationships -}}
{{- if not $first }},{{ end -}}
{{- $first = false }}
    {"source": {{ $source | jsonify }}, "target": {{ .target | jsonify }}, "type": {{ .type | default "soft" | jsonify }}, "label": {{ .label | jsonify }}}
{{- end -}}
{{- end -}}
{{- end }}
  ]
}
